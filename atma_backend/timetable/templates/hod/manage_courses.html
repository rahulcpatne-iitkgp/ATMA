{% extends "hod/base.html" %}
{% load custom_filters %}
{% block content %}
<main class="manage-courses-container">
  <h1>Manage Courses</h1>
  <div class="course-list">
    <h2>Available Courses</h2>
    <table class="table">
      <thead>
        <tr>
          <th>Name</th>
          <th>Code</th>
          <th>Credits</th>
          <th>Teacher</th>
          <th>TimeSlots</th>
          <th>Options</th>
        </tr>
      </thead>
      <tbody>
        {% for course in courses %}
          <tr>
            <td>{{ course.name }}</td>
            <td>{{ course.code }}</td>
            <td>{{ course.credits }}</td>
            <td>{{ course.teacher }}</td>
            <td>
              {% if course.schedules.exists %}
                {% for day in "Monday,Tuesday,Wednesday,Thursday,Friday"|split:"," %}
                  {% with day_schedules=course.schedules.all|filter_by_day:day %}
                    {% if day_schedules %}
                      {% for schedule in day_schedules %}
                        {{ schedule.timeslot }} in {{ schedule.classroom.name }}<br>
                      {% endfor %}
                    {% endif %}
                  {% endwith %}
                {% endfor %}
              {% else %}  
                <form method="post" action="{% url 'hod-schedule-course' course.id %}">
                  {% csrf_token %}
                  <button type="submit" class="btn btn-success">Add to timetable</button>
                </form>
              {% endif %}
            </td>
            <td>
              <form method="post" action="{% url 'hod-delete-course' course.id %}" id="delete-form-{{ course.id }}">
                {% csrf_token %}
                <button type="button" class="btn btn-danger" onclick="confirmDelete('{{ course.name }}', '{{ course.id }}')">Delete</button>
              </form>
            </td>
          </tr>
        {% empty %}
          <tr>
            <td colspan="6">No courses available.</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  <div class="create-course">
    <a href="{% url 'hod-create-course' %}">Create New Course</a>
  </div>
</main>

<script>
function confirmDelete(courseName, courseId) {
  if (confirm(`Are you sure you want to delete the course "${courseName}"? This action cannot be undone.`)) {
    document.getElementById(`delete-form-${courseId}`).submit();
  }
}
</script>
{% endblock %}